# BUILDME Template System - Redesign Proposal

## Current Problems

1. **Duplication**: BUILDME.sh, BUILDME-BASE.sh, BUILDME.md, README.md all contain similar info
2. **Confusion**: Not clear which file is the "source of truth"
3. **Maintenance**: Changes need to be made in multiple places
4. **Unused files**: `base.hbs` doesn't seem connected to anything

## How Templates Currently Work

The system uses **Handlebars** via `templates/engine.js`:

- `.hbs` files are templates with variables
- `engine.js` compiles them with provided data
- Used for compliance frameworks, epics, requirements

## Proposed Clean Structure

```
templates/buildme/
├── buildme.hbs                    # SINGLE source template
├── presets/                       # Project type configurations
│   ├── nodejs.yaml
│   ├── python.yaml
│   ├── go.yaml
│   ├── rust.yaml
│   └── monorepo.yaml
├── README.md                      # User documentation
└── DESIGN.md                      # Development notes
```

## How It Would Work

### 1. Single Handlebars Template (`buildme.hbs`)

```handlebars
#!/bin/bash # BUILDME.sh -
{{project.name}}
build script # Generated by: sc init --project-type={{project.type}}
# Version: 2.0.0 set -e #
============================================================================== #
CONFIGURATION #
==============================================================================
PROJECT_TYPE="{{project.type}}" BUILD_COMMAND="{{build.command}}" TEST_COMMAND="{{build.test}}"
INSTALL_COMMAND="{{dependencies.install}}"

{{#if build.pre_build}}
  # Pre-build steps PRE_BUILD=(
  {{#each build.pre_build}}
    "{{this}}"
  {{/each}}
  )
{{/if}}

# ... rest of script with conditional logic
```

### 2. Preset Files Define Variables

**`presets/nodejs.yaml`:**

```yaml
project:
  type: nodejs

dependencies:
  install: |
    if [[ -f "pnpm-lock.yaml" ]]; then
      pnpm install
    elif [[ -f "yarn.lock" ]]; then
      yarn install
    else
      npm ci || npm install
    fi

build:
  command: npm run build
  test: npm test
  lint: npm run lint

  pre_build:
    - npm run lint
    - npm run type-check

smoke_tests: |
  # Test module import
  MAIN_FILE=$(node -pe "require('./package.json').main || 'index.js'")
  if [[ -f "$MAIN_FILE" ]]; then
    node -e "require('./$MAIN_FILE')"
  fi
```

### 3. Generation Command

```bash
# User generates from preset
sc init --project-type=nodejs

# Or auto-detect
sc init  # Detects package.json → uses nodejs preset

# Or custom
sc init --from-template=custom-build.yaml
```

## Migration Plan

### Phase 1: Consolidate Documentation

- ✅ Keep: `README.md` (user docs)
- ✅ Delete: `BUILDME.md` (duplicate), old README
- ✅ Add: `DESIGN.md` (for developers)

### Phase 2: Create Template System

- Create `buildme.hbs` from BUILDME-BASE.sh
- Create preset YAML files
- Update `engine.js` if needed

### Phase 3: Integration

- Add generation command to `sc init`
- Update docs to reference new system
- Deprecate old templates

### Phase 4: Cleanup

- Delete: BUILDME.sh, BUILDME-BASE.sh
- Archive: examples/ → moved into presets
- Keep: buildme.hbs, presets/, README.md

## Benefits

1. **Single Source of Truth**: One `.hbs` template
2. **Easy Customization**: Edit YAML presets, not bash scripts
3. **Consistent System**: Uses existing Handlebars engine
4. **Less Duplication**: Variables defined once
5. **Better Testing**: Can test template generation separately

## Alternative: Just Use Base Script

If Handlebars is overkill:

```
templates/buildme/
├── BUILDME.sh                     # Universal auto-detecting script
├── README.md                      # Documentation
└── config.example.yaml            # Show users how to configure supernal.yaml
```

**Keep it simple**: One smart script that reads `supernal.yaml`, no generation needed.

## Recommendation

**Option 2 (Simple)** is better because:

- BUILDME-BASE.sh already auto-detects everything
- No generation step needed
- Users just copy one file
- Configure via `supernal.yaml` (already exists)
- Less moving parts = less to maintain

```bash
# User workflow:
cp templates/buildme/BUILDME.sh ./
chmod +x BUILDME.sh
./BUILDME.sh  # Auto-detects project type from files
```

## What to Keep

```
templates/buildme/
├── BUILDME.sh         # The smart universal script (rename from BUILDME-BASE.sh)
└── README.md          # User documentation

# Delete:
├── BUILDME-BASE.sh    # Rename to BUILDME.sh
├── BUILDME.md         # Duplicate info
├── base.hbs           # Not connected to anything
├── examples/          # Complexity for little benefit
└── old README.md      # Delete after merging info
```

Users configure behavior in their `supernal.yaml`:

```yaml
build:
  command: 'npm run build'
  test: 'npm test'
```

No template generation needed. Just one smart script.
